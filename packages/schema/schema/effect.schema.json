{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/effect",
  "definitions": {
    "effect": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "trigger": {
            "type": "string",
            "enum": [
              "OnBattleStart",
              "BeforeSort",
              "BeforeAttack",
              "PreDamage",
              "OnCritPreDamage",
              "OnDamage",
              "Shield",
              "PostDamage",
              "OnCritPostDamage",
              "OnBeforeHit",
              "OnHit",
              "OnMiss",
              "AfterAttacked",
              "OnDefeat",
              "TurnStart",
              "TurnEnd",
              "OnAddMark",
              "OnRemoveMark",
              "OnMarkCreate",
              "OnMarkDestroy",
              "OnMarkDurationEnd",
              "OnStack",
              "OnHeal",
              "OnRageGain",
              "OnRageLoss",
              "OnSwitchIn",
              "OnSwitchOut",
              "OnOwnerSwitchIn",
              "OnOwnerSwitchOut",
              "BeforeEffect",
              "AfterEffect"
            ]
          },
          "priority": {
            "type": "number"
          },
          "apply": {
            "anyOf": [
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "dealDamage"
                  },
                  "target": {
                    "anyOf": [
                      {
                        "type": "string",
                        "enum": [
                          "target",
                          "self",
                          "foe",
                          "petOwners",
                          "foeOwners",
                          "usingSkillContext",
                          "damageContext",
                          "mark",
                          "selfMarks",
                          "foeMarks"
                        ]
                      },
                      {
                        "type": "object",
                        "properties": {
                          "base": {
                            "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/0"
                          },
                          "chain": {
                            "type": "array",
                            "items": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "select"
                                    },
                                    "arg": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "base"
                                            },
                                            "arg": {
                                              "type": "string",
                                              "enum": [
                                                "hp",
                                                "maxhp",
                                                "rage",
                                                "owner",
                                                "type",
                                                "marks",
                                                "stats",
                                                "stack",
                                                "duration",
                                                "power",
                                                "priority",
                                                "activePet",
                                                "skills",
                                                "id",
                                                "baseId",
                                                "tags"
                                              ]
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "arg"
                                          ],
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "dynamic"
                                            },
                                            "arg": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "arg"
                                          ],
                                          "additionalProperties": false
                                        }
                                      ]
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "selectPath"
                                    },
                                    "arg": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "selectProp"
                                    },
                                    "arg": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "where"
                                    },
                                    "arg": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "compare"
                                            },
                                            "target": {
                                              "type": "string"
                                            },
                                            "operator": {
                                              "type": "string",
                                              "enum": [
                                                ">",
                                                "<",
                                                ">=",
                                                "<=",
                                                "=="
                                              ]
                                            },
                                            "value": {
                                              "anyOf": [
                                                {
                                                  "type": "object",
                                                  "properties": {
                                                    "type": {
                                                      "type": "string",
                                                      "const": "raw:number"
                                                    },
                                                    "value": {
                                                      "type": "number"
                                                    }
                                                  },
                                                  "required": [
                                                    "type",
                                                    "value"
                                                  ],
                                                  "additionalProperties": false
                                                },
                                                {
                                                  "type": "object",
                                                  "properties": {
                                                    "type": {
                                                      "type": "string",
                                                      "const": "raw:string"
                                                    },
                                                    "value": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "required": [
                                                    "type",
                                                    "value"
                                                  ],
                                                  "additionalProperties": false
                                                },
                                                {
                                                  "type": "object",
                                                  "properties": {
                                                    "type": {
                                                      "type": "string",
                                                      "const": "raw:boolean"
                                                    },
                                                    "value": {
                                                      "type": "boolean"
                                                    }
                                                  },
                                                  "required": [
                                                    "type",
                                                    "value"
                                                  ],
                                                  "additionalProperties": false
                                                },
                                                {
                                                  "type": "object",
                                                  "properties": {
                                                    "type": {
                                                      "type": "string",
                                                      "const": "raw:markId"
                                                    },
                                                    "value": {
                                                      "type": "string"
                                                    }
                                                  },
                                                  "required": [
                                                    "type",
                                                    "value"
                                                  ],
                                                  "additionalProperties": false
                                                },
                                                {
                                                  "type": "object",
                                                  "properties": {
                                                    "type": {
                                                      "type": "string",
                                                      "const": "dynamic"
                                                    },
                                                    "selector": {
                                                      "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                                                    }
                                                  },
                                                  "required": [
                                                    "type",
                                                    "selector"
                                                  ],
                                                  "additionalProperties": false
                                                }
                                              ]
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "target",
                                            "operator",
                                            "value"
                                          ],
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "same"
                                            },
                                            "value": {
                                              "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "value"
                                          ],
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "any"
                                            },
                                            "conditions": {
                                              "type": "array",
                                              "items": {
                                                "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg"
                                              }
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "conditions"
                                          ],
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "all"
                                            },
                                            "conditions": {
                                              "type": "array",
                                              "items": {
                                                "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg"
                                              }
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "conditions"
                                          ],
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "const": "probability"
                                            },
                                            "percent": {
                                              "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "percent"
                                          ],
                                          "additionalProperties": false
                                        }
                                      ]
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "whereAttr"
                                    },
                                    "extractor": {
                                      "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/0/properties/arg"
                                    },
                                    "condition": {
                                      "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "extractor",
                                    "condition"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "and"
                                    },
                                    "arg": {
                                      "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "or"
                                    },
                                    "arg": {
                                      "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                                    },
                                    "duplicate": {
                                      "type": "boolean"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "randomPick"
                                    },
                                    "arg": {
                                      "type": "integer",
                                      "exclusiveMinimum": 0
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "randomSample"
                                    },
                                    "arg": {
                                      "type": "number",
                                      "minimum": 0,
                                      "maximum": 1
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "sum"
                                    }
                                  },
                                  "required": [
                                    "type"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "add"
                                    },
                                    "arg": {
                                      "anyOf": [
                                        {
                                          "type": "number"
                                        },
                                        {
                                          "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                                        }
                                      ]
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "multiply"
                                    },
                                    "arg": {
                                      "anyOf": [
                                        {
                                          "type": "number"
                                        },
                                        {
                                          "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                                        }
                                      ]
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "divide"
                                    },
                                    "arg": {
                                      "anyOf": [
                                        {
                                          "type": "number"
                                        },
                                        {
                                          "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                                        }
                                      ]
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "shuffled"
                                    }
                                  },
                                  "required": [
                                    "type"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "clampMax"
                                    },
                                    "arg": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "const": "clampMin"
                                    },
                                    "arg": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "arg"
                                  ],
                                  "additionalProperties": false
                                }
                              ]
                            }
                          }
                        },
                        "required": [
                          "base"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "heal"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "addMark"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "mark": {
                    "type": "string"
                  },
                  "duration": {
                    "type": "number"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "mark",
                  "duration"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "addStacks"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "mark": {
                    "type": "string"
                  },
                  "value": {
                    "type": "number"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "mark",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "consumeStacks"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "mark": {
                    "type": "string"
                  },
                  "value": {
                    "type": "number"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "mark",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "modifyStat"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "statType": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  },
                  "percent": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "statType",
                  "value",
                  "percent"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "statStageBuff"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "statType": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "statType",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "addRage"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "amplifyPower"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "addPower"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "value": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "value"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "transferMark"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "mark": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg/anyOf/0/properties/value/anyOf/4"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "mark"
                ],
                "additionalProperties": false
              }
            ]
          },
          "condition": {
            "anyOf": [
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "evaluate"
                  },
                  "target": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target"
                  },
                  "evaluator": {
                    "$ref": "#/definitions/effect/items/properties/apply/anyOf/0/properties/target/anyOf/1/properties/chain/items/anyOf/3/properties/arg"
                  }
                },
                "required": [
                  "type",
                  "target",
                  "evaluator"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "some"
                  },
                  "conditions": {
                    "type": "array",
                    "items": {
                      "$ref": "#/definitions/effect/items/properties/condition"
                    }
                  }
                },
                "required": [
                  "type",
                  "conditions"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "every"
                  },
                  "conditions": {
                    "type": "array",
                    "items": {
                      "$ref": "#/definitions/effect/items/properties/condition"
                    }
                  }
                },
                "required": [
                  "type",
                  "conditions"
                ],
                "additionalProperties": false
              },
              {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "const": "not"
                  },
                  "condition": {
                    "$ref": "#/definitions/effect/items/properties/condition"
                  }
                },
                "required": [
                  "type",
                  "condition"
                ],
                "additionalProperties": false
              }
            ]
          },
          "consumesStacks": {
            "type": "number"
          }
        },
        "required": [
          "id",
          "trigger",
          "priority",
          "apply"
        ],
        "additionalProperties": false
      }
    }
  }
}